# ARCHITECTURE.md - System Architecture

## ğŸ“ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PicoCalc Hardware                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Pico 2   â”‚  â”‚ 320x320  â”‚  â”‚ 2x 18650 Li-ion â”‚  â”‚
â”‚  â”‚ RP2040   â”‚â”€â”€â”‚ Display  â”‚  â”‚ (7600mAh)       â”‚  â”‚
â”‚  â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ GPIO29   â”‚â”€â”€[VSYS ADC]â”€â”€[Battery Voltage]      â”‚
â”‚  â”‚ Pins26/27â”‚â”€â”€[MP3 Audio]                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MicroPython Firmware                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Built-in Modules: machine, gc, sys, os       â”‚  â”‚
â”‚  â”‚ Custom Modules: picocalc, mp3, vtterminal    â”‚  â”‚
â”‚  â”‚ Functions: edit()                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Dashboard Core Modules (/sd/new/)        â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  battery.py  â”‚    â”‚    ui.py     â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚ - ADC Read   â”‚    â”‚ - Drawing    â”‚             â”‚
â”‚  â”‚ - Voltage    â”‚    â”‚ - Text       â”‚             â”‚
â”‚  â”‚ - Percentage â”‚    â”‚ - Colors     â”‚             â”‚
â”‚  â”‚ - USB Detect â”‚    â”‚ - Battery    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   Icon       â”‚             â”‚
â”‚         â”‚            â”‚ - Progress   â”‚             â”‚
â”‚         â”‚            â”‚   Bar        â”‚             â”‚
â”‚         â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                   â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚          menu.py                   â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ - Main Menu                        â”‚           â”‚
â”‚  â”‚ - Navigation                       â”‚           â”‚
â”‚  â”‚ - Page Manager                     â”‚           â”‚
â”‚  â”‚   â€¢ Memory Stats                   â”‚           â”‚
â”‚  â”‚   â€¢ Battery Details                â”‚           â”‚
â”‚  â”‚   â€¢ App Launcher                   â”‚           â”‚
â”‚  â”‚   â€¢ File Editor                    â”‚           â”‚
â”‚  â”‚   â€¢ Music Player                   â”‚           â”‚
â”‚  â”‚   â€¢ Power Menu                     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚        â”‚                                           â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚        â–¼          â–¼          â–¼          â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚fileselectâ”‚ â”‚ loadapp â”‚ â”‚  play   â”‚ â”‚  test  â”‚ â”‚
â”‚  â”‚   .py    â”‚ â”‚   .py   â”‚ â”‚  .py    â”‚ â”‚  .py   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Browse   â”‚ â”‚ Select  â”‚ â”‚ Select  â”‚ â”‚ Unit   â”‚ â”‚
â”‚  â”‚ Filter   â”‚ â”‚ & Run   â”‚ â”‚ & Play  â”‚ â”‚ Tests  â”‚ â”‚
â”‚  â”‚ Scroll   â”‚ â”‚ Python  â”‚ â”‚ MP3     â”‚ â”‚ for    â”‚ â”‚
â”‚  â”‚ Select   â”‚ â”‚ Apps    â”‚ â”‚ Files   â”‚ â”‚ all    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Data Flow

### Battery Monitoring Flow
```
Hardware ADC â†’ battery.py â†’ ui.py â†’ Display
     â”‚              â”‚          â”‚
  GPIO29      Read voltage  Draw icon
  (VSYS)      Calculate %   Show color
                USB detect   Update text
```

### Menu Navigation Flow
```
User Input â†’ menu.py â†’ ui.py â†’ Display
    â”‚           â”‚         â”‚
  Arrows    Navigation  Drawing
  Enter     Selection   Refresh
  Q key     Action      Update
```

### File Selection Flow
```
menu.py â†’ fileselect.py â†’ os.listdir() â†’ Display
   â”‚            â”‚              â”‚
Request      Browse           Files
Path         Filter           List
Callback     Select           Show
   â”‚            â”‚              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
            Return path
```

### App Execution Flow
```
menu.py â†’ loadapp.py â†’ fileselect.py â†’ exec()
   â”‚          â”‚              â”‚            â”‚
Launch    Request file   User selects  Run code
          Read file      Return path   Show result
```

## ğŸ—ï¸ Module Dependencies

```
menu.py
  â”œâ”€â”€ ui.py
  â”‚   â””â”€â”€ picocalc.display
  â”œâ”€â”€ battery.py
  â”‚   â””â”€â”€ machine.ADC
  â”œâ”€â”€ fileselect.py
  â”‚   â”œâ”€â”€ ui.py
  â”‚   â””â”€â”€ os
  â”œâ”€â”€ loadapp.py
  â”‚   â”œâ”€â”€ ui.py
  â”‚   â””â”€â”€ fileselect.py
  â””â”€â”€ play.py
      â”œâ”€â”€ ui.py
      â”œâ”€â”€ fileselect.py
      â”œâ”€â”€ mp3
      â”œâ”€â”€ vtterminal
      â””â”€â”€ machine.UART

test_dashboard.py
  â”œâ”€â”€ battery.py
  â”œâ”€â”€ ui.py
  â”œâ”€â”€ fileselect.py
  â””â”€â”€ menu.py
```

## ğŸ“Š Function Call Hierarchy

### Main Entry Point
```
main()
  â””â”€â–º show_main_menu(battery_status)
       â”œâ”€â–º draw_title_bar()
       â”‚    â”œâ”€â–º draw_text()
       â”‚    â”œâ”€â–º draw_battery_status()
       â”‚    â”‚    â””â”€â–º draw_battery_icon()
       â”‚    â””â”€â–º draw_line_horizontal()
       â”œâ”€â–º draw_menu_item() (Ã—7)
       â””â”€â–º wait_key_raw()
            â””â”€â–º Return choice
```

### Battery Status Page
```
show_battery_details()
  â”œâ”€â–º get_battery_status()
  â”‚    â””â”€â–º BatteryMonitor.get_status()
  â”‚         â”œâ”€â–º read_vsys_voltage()
  â”‚         â”‚    â””â”€â–º ADC.read_u16()
  â”‚         â”œâ”€â–º is_usb_powered()
  â”‚         â””â”€â–º voltage_to_percentage()
  â”œâ”€â–º draw_title_bar()
  â”œâ”€â–º draw_text() (Ã—N)
  â”œâ”€â–º draw_progress_bar()
  â””â”€â–º wait_key_raw()
```

### File Selection
```
select_file(path, exts, title)
  â”œâ”€â–º os.listdir(path)
  â”œâ”€â–º Filter by extensions
  â”œâ”€â–º Sort files
  â””â”€â–º Loop:
       â”œâ”€â–º clear()
       â”œâ”€â–º draw_title_bar()
       â”œâ”€â–º draw_menu_item() (Ã—visible)
       â”œâ”€â–º wait_key_raw()
       â””â”€â–º Return selected path
```

## ğŸ’¾ Memory Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         RAM (256KB typical)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MicroPython Runtime                 â”‚ ~50-100KB
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Framebuffer (320x320x1bit)          â”‚ ~13KB
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dashboard Modules (loaded)          â”‚ ~15KB
â”‚  - menu.py                          â”‚
â”‚  - ui.py                            â”‚
â”‚  - battery.py                       â”‚
â”‚  - fileselect.py (when used)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Free Memory (gc.mem_free())         â”‚ ~100KB+
â”‚  - User apps                        â”‚
â”‚  - Temporary data                   â”‚
â”‚  - Stack/heap                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Storage (/sd card):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /sd/new/                            â”‚
â”‚  â”œâ”€â”€ battery.py          (~7KB)     â”‚
â”‚  â”œâ”€â”€ ui.py               (~9KB)     â”‚
â”‚  â”œâ”€â”€ menu.py             (~15KB)    â”‚
â”‚  â”œâ”€â”€ fileselect.py       (~5KB)     â”‚
â”‚  â”œâ”€â”€ loadapp.py          (~2KB)     â”‚
â”‚  â”œâ”€â”€ play.py             (~4KB)     â”‚
â”‚  â”œâ”€â”€ test_dashboard.py   (~7KB)     â”‚
â”‚  â””â”€â”€ docs/*.md           (~50KB)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /sd/ (user files)                   â”‚
â”‚  â”œâ”€â”€ *.py (apps)                    â”‚
â”‚  â”œâ”€â”€ *.mp3 (music)                  â”‚
â”‚  â””â”€â”€ *.txt (data)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš¡ Execution Flow

### Boot Sequence
```
1. Power On / Reset
   â†“
2. MicroPython Boots
   â†“
3. Run /sd/main.py (if exists)
   â†“
4. Import dashboard modules
   â”‚  sys.path.append('/sd/new')
   â”‚  from menu import main
   â†“
5. Initialize
   â”‚  - Hide cursor
   â”‚  - Read battery
   â”‚  - Clear screen
   â†“
6. Show Main Menu
   â”‚  - Draw UI
   â”‚  - Wait for input
   â†“
7. User Selection
   â”‚  â”œâ”€â–º Memory Stats â†’ Show â†’ Return
   â”‚  â”œâ”€â–º Battery â†’ Show â†’ Return
   â”‚  â”œâ”€â–º Run App â†’ Select â†’ Execute â†’ Return
   â”‚  â”œâ”€â–º Edit File â†’ Select â†’ Edit â†’ Return
   â”‚  â”œâ”€â–º Play Music â†’ Select â†’ Play â†’ Return
   â”‚  â”œâ”€â–º REPL â†’ Exit dashboard
   â”‚  â””â”€â–º Reset â†’ Reboot
   â†“
8. Loop to step 6 (unless REPL/Reset)
```

### Event Loop
```
while True:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Read Battery Status             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Draw Screen                     â”‚
    â”‚  - Clear                        â”‚
    â”‚  - Title bar (with battery)     â”‚
    â”‚  - Menu items                   â”‚
    â”‚  - Help text                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Wait for Input (blocking)       â”‚
    â”‚  - Arrow keys                   â”‚
    â”‚  - Enter key                    â”‚
    â”‚  - Q key                        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Process Input                   â”‚
    â”‚  - Update selection             â”‚
    â”‚  - Execute action               â”‚
    â”‚  - Show result                  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Update State                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    Loop back to top
```

## ğŸ¨ UI Component Hierarchy

```
Screen (320x320)
  â””â”€â–º Title Bar (y: 0-24)
       â”œâ”€â–º Title Text (left)
       â”œâ”€â–º Battery Icon (right)
       â”‚    â”œâ”€â–º Outline (26x12px)
       â”‚    â”œâ”€â–º Terminal (2x6px)
       â”‚    â”œâ”€â–º Fill (dynamic %)
       â”‚    â””â”€â–º Percentage Text
       â””â”€â–º Separator Line
  â””â”€â–º Content Area (y: 32-280)
       â”œâ”€â–º Menu Items
       â”‚    â”œâ”€â–º Prefix ("> " or "  ")
       â”‚    â””â”€â–º Text (colored)
       â”œâ”€â–º Info Text
       â”œâ”€â–º Progress Bars
       â”‚    â”œâ”€â–º Outline
       â”‚    â”œâ”€â–º Background
       â”‚    â””â”€â–º Fill (colored)
       â””â”€â–º Lists
            â”œâ”€â–º Scrollable Items
            â””â”€â–º Scroll Indicator
  â””â”€â–º Footer (y: 290-310)
       â””â”€â–º Help Text
```

## ğŸ”Œ Hardware Interface Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Dashboard Software            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                    â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Display â”‚      â”‚   Battery   â”‚   â”‚  Audio  â”‚
â”‚ (320x320)â”‚      â”‚  (VSYS ADC) â”‚   â”‚(Pins 26/27)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                  â”‚                â”‚
     â–¼                  â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       picocalc.display                     â”‚
â”‚       machine.ADC(29)                      â”‚
â”‚       mp3.init()                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§© Module Interactions

```
User Action â†’ menu.py
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼           â–¼           â–¼           â–¼
battery.py   ui.py    fileselect.py  loadapp.py
    â”‚           â”‚           â”‚           â”‚
    â–¼           â–¼           â–¼           â–¼
Hardware    Display     Filesystem    exec()
(ADC)       (FB)        (SD card)     (Python)
```

## ğŸ“ˆ Performance Characteristics

| Operation | Time | Memory | Notes |
|-----------|------|--------|-------|
| Battery read | ~10ms | ~1KB | 10 samples averaged |
| Screen clear | ~5ms | 0 | Hardware operation |
| Draw text | <1ms | 0 | Per character |
| File list | 10-100ms | ~2KB | Depends on file count |
| Menu render | ~20ms | ~2KB | Full screen update |
| App exec | Variable | Variable | User code dependent |

## ğŸ” Error Handling Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Try Operation               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ Success?â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â–¼         â–¼
   YES       NO
    â”‚         â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    â”‚ Catch Exception      â”‚
    â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚    â”‚ - Clear screen       â”‚
    â”‚    â”‚ - Show error message â”‚
    â”‚    â”‚ - Display details    â”‚
    â”‚    â”‚ - Wait for key       â”‚
    â”‚    â”‚ - Return to menu     â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â–¼
    Continue
```

## ğŸ¯ Design Patterns Used

1. **Singleton Pattern**: BatteryMonitor instance
2. **Factory Pattern**: get_monitor() function
3. **Callback Pattern**: UI event handlers
4. **State Machine**: Menu navigation
5. **Template Method**: Screen rendering
6. **Strategy Pattern**: Color selection based on state
7. **Observer Pattern**: Battery status updates

## ğŸš¦ State Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  START  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Main    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Menu    â”‚              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â”‚
     â”‚                   â”‚
     â”œâ”€â–º REPL â”€â”€â”€â”€â”€â”€â–º Exit
     â”‚                   â”‚
     â”œâ”€â–º Memory â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”¤
     â”‚                   â”‚
     â”œâ”€â–º Battery â”€â”€â”€â”€â”€â”€â”€â–ºâ”¤
     â”‚                   â”‚
     â”œâ”€â–º Run App â”€â”€â”€â”€â”€â”€â”€â–ºâ”¤
     â”‚      â””â”€â–º File Select â”€â–º Execute
     â”‚                   â”‚
     â”œâ”€â–º Edit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”¤
     â”‚      â””â”€â–º File Select â”€â–º Editor
     â”‚                   â”‚
     â”œâ”€â–º Music â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”¤
     â”‚      â””â”€â–º File Select â”€â–º Player
     â”‚                   â”‚
     â””â”€â–º Power â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”¤
            â””â”€â–º Confirm â”€â–º Reset
```

---

This architecture is designed for:
- âœ… **Modularity** - Each component is independent
- âœ… **Maintainability** - Clear separation of concerns
- âœ… **Extensibility** - Easy to add new features
- âœ… **Performance** - Minimal memory footprint
- âœ… **Reliability** - Comprehensive error handling
